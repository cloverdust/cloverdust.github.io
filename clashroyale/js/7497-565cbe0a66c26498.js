(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7497,9424],{89424:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>o});var i,n=s(19779);function a(){return(a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)({}).hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(null,arguments)}let o=function(t){return n.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16"},t),i||(i=n.createElement("path",{fill:"#121212",d:"M4 3C4 1.352 5.882.411 7.2 1.4l6.667 5a2 2 0 0 1 0 3.2l-6.667 5c-1.318.989-3.2.048-3.2-1.6z"})))}},43114:(t,e,s)=>{"use strict";s.d(e,{A:()=>o});var i,n=s(19779);function a(){return(a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)({}).hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(null,arguments)}let o=function(t){return n.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 1010 160"},t),i||(i=n.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M153.461 3.136c-2.47-.734-5.6.1-11.859 1.77L102.288 15.39c-3.888 1.037-5.831 1.555-7.276 2.662a9.14 9.14 0 0 0-2.886 3.756c-.698 1.682-.698 3.693-.698 7.717v4.006c0 6.478 0 9.717 1.346 11.914a9.14 9.14 0 0 0 5.193 3.99c2.47.734 5.6-.1 11.859-1.77l39.315-10.483c3.887-1.037 5.831-1.556 7.276-2.662a9.15 9.15 0 0 0 2.886-3.757c.697-1.681.697-3.693.697-7.716V19.04c0-6.478 0-9.717-1.346-11.915a9.14 9.14 0 0 0-5.193-3.99M62.033 25.993c-2.3-.683-5.17-.007-10.606 1.436-.013-5.235-.137-8.045-1.344-10.017a9.14 9.14 0 0 0-5.193-3.99c-2.47-.734-5.6.1-11.86 1.77l-5.028 1.34c-3.887 1.037-5.83 1.556-7.276 2.663a9.14 9.14 0 0 0-2.886 3.756c-.697 1.681-.697 3.693-.697 7.716v5.904l-6.284 1.676c-3.887 1.037-5.83 1.555-7.276 2.662a9.14 9.14 0 0 0-2.886 3.756C0 46.347 0 48.358 0 52.382v4.006c0 6.478 0 9.717 1.346 11.914a9.14 9.14 0 0 0 5.193 3.99c2.3.683 5.17.007 10.605-1.436.013 5.236.137 8.046 1.344 10.018a9.14 9.14 0 0 0 5.194 3.99c2.47.734 5.6-.101 11.859-1.77l5.028-1.341c3.888-1.037 5.831-1.555 7.276-2.662a9.14 9.14 0 0 0 2.886-3.756c.698-1.682.698-3.693.698-7.717v-5.904l6.283-1.675c3.887-1.037 5.831-1.555 7.276-2.662a9.14 9.14 0 0 0 2.886-3.757c.697-1.681.697-3.693.697-7.716v-4.006c0-6.478 0-9.717-1.345-11.915a9.14 9.14 0 0 0-5.193-3.99m97.856 61.498q.111 1.955.111 3.938C160 129.298 129.299 160 91.429 160c-26.643 0-49.736-15.194-61.089-37.39-1.818-3.556-2.727-5.333-2.575-7.828.117-1.92 1.235-4.446 2.577-5.824 1.744-1.79 4.11-2.431 8.84-3.714L143.48 76.959c4.735-1.285 7.103-1.927 9.513-1.263 1.856.512 4.095 2.127 5.166 3.726 1.392 2.077 1.505 4.074 1.731 8.07m-65.604 58.407a2.118 2.118 0 0 0 2.295 2.444c22.633-2.022 41.467-17.24 48.754-37.906a2.115 2.115 0 0 0-1.806-2.826 46 46 0 0 0-4.1-.181c-22.781 0-41.671 16.664-45.143 38.469m153.094-27.413h25.48c2.669 0 4.833 2.149 4.833 4.8V135.2c0 2.651-2.164 4.8-4.833 4.8h-48.026c-2.669 0-4.833-2.149-4.833-4.8V24.8c0-2.651 2.164-4.8 4.833-4.8h48.026c2.669 0 4.833 2.149 4.833 4.8v11.544c0 2.65-2.164 4.8-4.833 4.8h-25.48v28.191h23.524c2.67 0 4.834 2.15 4.834 4.8v10.802c0 2.651-2.164 4.8-4.834 4.8h-23.524zM453.823 51.53c2.67 0 4.834-2.149 4.834-4.8v-2.248Q458.657 20 434.406 20h-21.708q-24.25 0-24.25 24.482v22.071q0 24.483 24.25 24.483h17.601q1.565 0 2.543 1.112 1.173 1.113 1.173 2.597v21.7q0 1.484-1.173 2.597-.978 1.113-2.543 1.113h-12.125q-1.565 0-2.738-1.113a3.8 3.8 0 0 1-.978-2.597v-6.699c0-2.651-2.164-4.8-4.833-4.8h-16.344c-2.669 0-4.833 2.149-4.833 4.8v5.772q0 24.482 24.25 24.482h23.077q24.25 0 24.251-24.482V91.592q0-24.111-24.251-24.482h-17.601q-1.565 0-2.738-1.113a3.8 3.8 0 0 1-.978-2.597V43.926q0-1.485.978-2.597 1.173-1.113 2.738-1.113h10.756q1.565 0 2.543 1.113 1.173 1.113 1.173 2.597v2.804c0 2.651 2.164 4.8 4.833 4.8zm95.251-25.128c1.114-3.123-1.219-6.402-4.556-6.402h-15.375a4.83 4.83 0 0 0-4.631 3.427l-14.028 46.65-14.029-46.65A4.83 4.83 0 0 0 491.824 20h-15.375c-3.337 0-5.67 3.279-4.556 6.402l24.901 69.827V135.2c0 2.651 2.164 4.8 4.833 4.8h17.713c2.669 0 4.833-2.149 4.833-4.8V96.229zM590.387 135.2V92.89h22.937c2.669 0 4.833-2.149 4.833-4.8v-12.1c0-2.65-2.164-4.8-4.833-4.8h-22.937V42.442h24.893c2.669 0 4.833-2.149 4.833-4.8V24.8c0-2.651-2.164-4.8-4.833-4.8h-47.439c-2.67 0-4.834 2.149-4.834 4.8v110.4c0 2.651 2.164 4.8 4.834 4.8h17.712c2.67 0 4.834-2.149 4.834-4.8M686.164 20c-2.67 0-4.834 2.149-4.834 4.8v92.943q0 1.484-1.173 2.597-.978 1.113-2.543 1.113h-10.56q-1.565 0-2.738-1.113a3.8 3.8 0 0 1-.978-2.597V24.8c0-2.651-2.164-4.8-4.833-4.8h-17.713c-2.67 0-4.834 2.149-4.834 4.8v90.718q0 24.482 24.251 24.482h24.25q24.25 0 24.251-24.482V24.8c0-2.651-2.164-4.8-4.834-4.8zM800 135.2c0 2.651-2.164 4.8-4.833 4.8h-17.713c-2.67 0-4.834-2.149-4.834-4.8V42.257q0-1.484-1.173-2.597-.978-1.113-2.542-1.113h-10.561q-1.565 0-2.738 1.113a3.8 3.8 0 0 0-.978 2.597V135.2c0 2.651-2.164 4.8-4.833 4.8h-17.713c-2.669 0-4.833-2.149-4.833-4.8V44.482q0-24.482 24.25-24.482h24.251Q800 20 800 44.482zM348.3 23.791A4.826 4.826 0 0 0 343.575 20h-19.983a4.825 4.825 0 0 0-4.725 3.791l-23.901 110.4c-.647 2.989 1.647 5.809 4.725 5.809h17.904a4.826 4.826 0 0 0 4.726-3.791l11.262-52.023 11.263 52.023a4.825 4.825 0 0 0 4.725 3.791h17.904c3.079 0 5.373-2.82 4.726-5.809zm555.273 68.173c-2.688 0-4.032 0-5.059-.523a4.8 4.8 0 0 1-2.098-2.098c-.523-1.027-.523-2.37-.523-5.059v-3.17c0-2.689 0-4.033.523-5.06a4.8 4.8 0 0 1 2.098-2.098c1.027-.523 2.371-.523 5.059-.523h17.822c2.688 0 4.032 0 5.059.523a4.8 4.8 0 0 1 2.098 2.098c.523 1.027.523 2.371.523 5.06v35.138q0 23.748-22.243 23.748h-22.599q-22.24 0-22.24-23.748V43.748q0-23.748 22.24-23.748h22.599q22.243 0 22.243 23.748v3.295c0 2.688 0 4.032-.523 5.059a4.8 4.8 0 0 1-2.098 2.098c-1.027.523-2.371.523-5.059.523h-8.497c-2.688 0-4.032 0-5.059-.523a4.8 4.8 0 0 1-2.098-2.098c-.523-1.027-.523-2.371-.523-5.06V40.69q0-1.44-1.075-2.52-.895-1.079-2.332-1.079h-11.3q-1.434 0-2.51 1.08-.899 1.08-.897 2.519v78.44q-.002 1.44.897 2.519 1.076 1.08 2.51 1.08h11.3q1.437 0 2.332-1.08 1.075-1.079 1.075-2.519V91.964zm80.925 0c-2.688 0-4.032 0-5.059-.523a4.8 4.8 0 0 1-2.098-2.098c-.523-1.027-.523-2.37-.523-5.059v-3.17c0-2.689 0-4.033.523-5.06a4.8 4.8 0 0 1 2.098-2.098c1.027-.523 2.371-.523 5.059-.523h17.822c2.69 0 4.03 0 5.06.523a4.82 4.82 0 0 1 2.1 2.098c.52 1.027.52 2.371.52 5.06v35.138c0 15.832-7.41 23.748-22.243 23.748h-22.599q-22.24 0-22.24-23.748V43.748q0-23.748 22.24-23.748h22.599C1002.59 20 1010 27.916 1010 43.748v3.295c0 2.688 0 4.032-.52 5.059a4.82 4.82 0 0 1-2.1 2.098c-1.03.523-2.37.523-5.06.523h-8.497c-2.688 0-4.032 0-5.059-.523a4.8 4.8 0 0 1-2.098-2.098c-.523-1.027-.523-2.371-.523-5.06V40.69q0-1.44-1.075-2.52-.895-1.079-2.332-1.079h-11.3q-1.434 0-2.51 1.08-.899 1.08-.897 2.519v78.44q-.001 1.44.897 2.519 1.076 1.08 2.51 1.08h11.3q1.437 0 2.332-1.08 1.075-1.079 1.075-2.519V91.964zM843.921 121.68c0-2.688 0-4.032-.523-5.059a4.8 4.8 0 0 0-2.098-2.098c-1.027-.523-2.371-.523-5.059-.523H825.68c-2.688 0-4.032 0-5.059.523a4.8 4.8 0 0 0-2.098 2.098c-.523 1.027-.523 2.371-.523 5.059v10.64c0 2.688 0 4.032.523 5.059a4.8 4.8 0 0 0 2.098 2.098c1.027.523 2.371.523 5.059.523h10.561c2.688 0 4.032 0 5.059-.523a4.8 4.8 0 0 0 2.098-2.098c.523-1.027.523-2.371.523-5.059z",clipRule:"evenodd"})))}},47497:(t,e,s)=>{"use strict";s.d(e,{default:()=>C});var i=s(1059);let n={src:"https://res.ldrescdn.com/easyfun/official/_next/static/media/black-face-loading.c09bac1e.png",height:48,width:48,blurWidth:0,blurHeight:0};var a=s(89424),o=s(6916),r=s(13021),c=s(93855),l=s(25542),u=s(48206),d=s(96928),h=s(75399),E=s.n(h),f=s(87320),p=s(56952),m=s(11485),v=s(19779);function g(){let t=(0,f.useAtomValue)(u.vD),{progress:{data:e},gameInfo:{details:{gameType:s}}}=(0,v.useContext)(o.i),h=(0,v.useMemo)(()=>t.status===d.fJ.LOADING,[t.status]),g=(0,f.useAtomValue)(u.Zm),[_,O]=(0,v.useState)(""),I=(0,v.useRef)(!1),T=(0,p.useTranslations)(),{start:y}=(0,r.Ic)(),{isLogged:S}=(0,c.bG)(),{setShowPersonalState:N}=(0,c.K6)(),{embeddedChannel:A}=(0,l.K)(),w=t=>{t===d.gg.TRIAL||S||s!==d.YU.CLOUD?y():(I.current=!0,N({show:!0,source:d.Pf.GAME_DETAIL_VISITOR_PLAY_BTN}))};return(0,v.useEffect)(()=>{O(S||s===d.YU.WEBSITE?"":"visitor-status"),S&&I.current&&(I.current=!1,y())},[S,I,y]),(0,i.jsx)("div",{className:E()("mt-6 h-14 w-57.5 flex cursor-pointer select-none of-hidden rd-2 transition-width-150 text-3.5","exl:w-48 exl:text-3 exl:h-12",A===d.k3.EASYFUN_EXE?"bg-cyan-5":"bg-green-5",{"bg-gray-5!":g},_),children:h?(0,i.jsxs)("div",{className:E()("min-w-57.5 flex flex-center text-3.5",A===d.k3.EASYFUN_EXE?"bg-cyan-5":"bg-green-5"),exl:"min-w-48 text-3",children:[(0,i.jsx)(m.default,{width:"24",height:"24",className:"mie-1 size-6",src:n,alt:""}),(0,i.jsx)("span",{className:"min-w-20 c-gray-1 font-600",children:"".concat(T("common.loading")," ").concat(e,"%")})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{type:"button",className:"play-on-browser min-w-57.5 cursor-pointer bg-transparent text-1em font-600 lh-1em transition-500",exl:"min-w-48",onClick:()=>S||A===d.k3.EASYFUN_EXE?w():null,children:[!h&&!g&&A!==d.k3.EASYFUN_EXE&&(0,i.jsx)(a.default,{className:"mie-2 size-1em v-text-top"}),g?(0,i.jsx)("span",{className:"px-2 text-1em c-#fff c-op-90 font-600 lh-1em underline",children:T("ads.blockTips")}):A===d.k3.EASYFUN_EXE?(0,i.jsx)("span",{className:E()("text-1em font-600 lh-1em c-#fff"),children:"Play now"}):(0,i.jsx)("span",{className:E()("text-1em font-600 lh-1em c-gray-1"),children:T("gameDetail.defaultStatusPlayBtn")||"Play on browser"})]}),(0,i.jsxs)("div",{className:"choose-btn-group min-w-57.5 w-fit flex of-hidden rd-2 transition-300 transition-ease-out",exl:"min-w-48",children:[(0,i.jsxs)("button",{type:"button",className:"trial-btn w-40% flex flex-center flex-col cursor-pointer bg-gray-5 px-1 transition-width-300",onClick:()=>w(d.gg.TRIAL),children:[(0,i.jsx)("span",{className:"text-1em c-#fff c-op-90 font-[Bebas_Neue]",exl:"text-1.25em",children:T("common.play")||"Play"}),(0,i.jsx)("small",{className:"mt-2px text-0.875em c-#fff c-op-90 lh-1.25em",exl:"text-1em",children:T("gameDetail.visitorPlayBtn",{min:30})})]}),(0,i.jsxs)("button",{type:"button",className:"login-play-btn flex flex-center flex-1 flex-col cursor-pointer bg-green-5 px-1 transition-width-300",onClick:()=>w(d.gg.LOGIN),children:[(0,i.jsx)("span",{className:"text-1em c-gray-1 font-[Bebas_Neue]",exl:"text-1.25em",children:T("common.login")||"Login"}),(0,i.jsx)("small",{className:"mt-2px text-0.875em c-gray-1 lh-1.25em",exl:"text-1em",children:T("gameDetail.userPlayBtn",{hour:6})||"6 hrs free/day"})]})]})]})})}s(64605);var _=s(58179);function O(t){let{children:e}=t,[s,n]=(0,v.useState)({visible:!1,props:{}}),a=(0,v.useMemo)(()=>({value:s,setValue:n}),[s]);return(0,i.jsx)(_.qP.Provider,{value:a,children:e})}var I=s(23482),T=s(68431),y=s(40260),S=s(43114),N=s(89720),A=s(40045),w=s.n(A);function b(){let{gameInfo:t}=(0,v.useContext)(o.i),{toGameDetail:e}=(0,N.F)();return(0,i.jsx)("section",{className:"mt-20 max-w-90% flex flex-col items-center",children:(0,i.jsxs)(w(),{prefetch:!1,href:e(t.details),target:"_blank",className:"relative mt-2 flex-center cursor-pointer items-center rd-2 p-3",children:[(0,i.jsx)("div",{className:"relative z-2 flex-center text-3.5 c-#fff c-op-90 transition-colors exl:text-3 hover:c-op-90",children:(0,i.jsx)("span",{className:"text-center text-8",children:"Access EasyFun.gg to Sign in get 6hours gaming time"})}),(0,i.jsxs)("button",{type:"button",className:"relative z-2 ml-4 h-10 rd-1 pie-0.5 pis-1.5 text-8 ld-button ld-button-green-outline",children:[(0,i.jsx)("span",{children:"Sign in"}),(0,i.jsx)("svg",{className:"size-1.5em",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{d:"M5 3L7 6L5 9",stroke:"current",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),(0,i.jsx)("div",{className:"absolute inset-0 size-full rd-2 bg-gray-1 bg-op-30 backdrop-blur-20px"})]})})}let R=(0,T.default)(()=>s.e(3496).then(s.bind(s,83496)),{loadableGenerated:{webpack:()=>[83496]},ssr:!1});function D(t){let{children:e}=t,{gameInfo:s}=(0,v.useContext)(o.i),{isEmbedded:n,embeddedChannel:a}=(0,l.K)(),r=(0,v.useMemo)(()=>{try{s.details.photos=JSON.parse(s.details.photos||"[]")[0]}catch(t){}return s.details},[s.details]),c=(0,v.useMemo)(()=>s.details.photos||{},[s.details]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.default,{className:"absolute left-0 top-0 z-3 aspect-ratio-880/496 h-full max-h-100vh",style:{filter:"blur(".concat(50*!c.image,"px)")},src:c.image||r.icon,alt:"".concat(s.details.gameName,"-poster"),sizes:"100vw",priority:!0,fill:!0}),(0,i.jsxs)("div",{className:"absolute inset-is-0 top-0 z-3 size-full flex-center flex-col",style:{backgroundColor:"rgba(0, 0, 0, ".concat(c.image?.7:.5,")")},children:[a===d.k3.THIRD_PARTY_WEBSITES&&(0,i.jsx)(S.A,{className:"pointer-events-none w-80% op-60"}),(0,i.jsx)("div",{className:"relative size-25 rd-4",children:(0,i.jsx)(m.default,{src:"".concat(r.icon),className:"size-25 rd-4 object-cover",alt:"".concat(r.gameName,"-icon"),fill:!0,sizes:"100px"})}),(0,i.jsx)("h1",{className:"mt-3 text-8 c-#fff font-normal font-[Bebas_Neue] md:mt-4",children:r.gameName||""}),e,a===d.k3.THIRD_PARTY_WEBSITES&&(0,i.jsx)(b,{}),!n&&r.gameType===d.YU.CLOUD&&(0,i.jsx)(R,{})]})]})}let L=(0,T.default)(()=>Promise.all([s.e(3561),s.e(9844),s.e(8465),s.e(4071),s.e(5766),s.e(2572)]).then(s.bind(s,2572)),{loadableGenerated:{webpack:()=>[2572]},ssr:!1});function C(t){let{gameInfo:e}=t,s=(0,f.useAtomValue)(u.vD),n=(0,v.useMemo)(()=>s.status===d.fJ.PLAYING,[s.status]);(0,r.I8)();let{isEmbedded:a}=(0,l.K)(),[c,h,p,m]=(0,y.A)(8e3),_=(0,v.useMemo)(()=>({gameInfo:e,progress:{data:Math.trunc(100*c),start:h,done:p,stop:m}}),[e,c,h,p,m]);return(0,v.useEffect)(m,[]),(0,i.jsx)("section",{className:E()("play-stage relative z-3 of-hidden bg-#000 rd-4",{"aspect-ratio-880/496":s.status!==d.fJ.PLAYING},a?"h-100vh mx-0! rd-0!":"lt-md-portrait:h-[calc(100vh-var(--layout-nav-height))] lt-md-portrait:h-[calc(100dvh-var(--layout-nav-height))]"),"lt-md":"w-100vw mx--5",md:"mx-auto w-full",children:(0,i.jsx)(o.i.Provider,{value:_,children:(0,i.jsxs)(O,{children:[!n&&(0,i.jsx)(D,{children:(0,i.jsx)(g,{})}),(0,i.jsx)(I.V,{children:(0,i.jsx)(L,{})},String(e.details.gameId))]})})})}},23482:(t,e,s)=>{"use strict";s.d(e,{A:()=>z,V:()=>W});var i=s(1059),n=s(48206),a=s(96928),o=s(44103),r=s(21920),c=s(87320),l=s(19779);let{connect:u,setParams:d,send:h,effect:E,close:f,clearEffectList:p,getWSInstance:m}=(0,o.gm)(),{init:v,rtcEffect:g,createOffer:_,setRemoteDescription:O,dataChannelSend:I,videoUpdateTimeout:T,addCandidate:y,close:S,clearEffectList:N,getLastRtt:A}=(0,o.UO)(h,E),{down:w,move:b,up:R,setControlLayerElement:D,updateStatusInfo:L,destroy:C,effect:M,setControlArea:x,addControlArea:U,deleteControlArea:P,getStatusInfo:k,getVideoRect:G,triggerSystemKey:K,clearEffectList:Y}=(0,o.Sq)(h,E,I),V={dispatch:{setMuted:t=>{},setQuality:t=>{},setKeyboardGUI:t=>{}},info:{muted:!1,isHorizontal:!1,quality:o.W8["360P"]},keyboardGUI:{buttonId:"",isShowAddPanel:{},isShowPresetKeyGUI:!0,status:a.ap.SHOW},wss:{connect:u,setParams:d,send:h,close:f,effect:E,clearEffect:p,getWSInstance:m},rtc:{init:v,effect:g,createOffer:_,close:S,setRemoteDescription:O,dataChannelSend:I,videoUpdateTimeout:T,addCandidate:y,getLastRtt:A,clearEffect:N},control:{down:w,move:b,up:R,setControlLayerElement:D,updateStatusInfo:L,destroy:C,effect:M,setControlArea:x,addControlArea:U,deleteControlArea:P,getStatusInfo:k,getVideoRect:G,triggerSystemKey:K,clearEffect:Y},resetDevice:()=>{}},z=(0,l.createContext)(V);function W(t){let{children:e}=t,s=(0,c.useSetAtom)(n.tv),[u,d]=(0,c.useAtom)(n.vD),[h,E]=(0,l.useState)(V.info.isHorizontal),[f,p]=(0,r.A)("EASYFUN_IS_MUTED",{defaultValue:V.info.muted}),[m,v]=(0,r.A)("EASYFUN_VIDEO_QUALITY",{defaultValue:V.info.quality}),[,g]=(0,r.A)("EASYFUN_SHOW_PRESET_KEY_GUI",{defaultValue:V.keyboardGUI.isShowPresetKeyGUI}),[_,O]=(0,l.useState)(V.keyboardGUI),I=(0,l.useMemo)(()=>({...V,keyboardGUI:_,info:{isHorizontal:h,muted:f,quality:m},dispatch:{setMuted:p,setQuality:v,setKeyboardGUI:O},resetDevice:T}),[h,f,p,m,v,_,O]);function T(){d(t=>({...t,status:a.fJ.IDLE,fullscreen:!1})),s({gameId:"",businessWssLink:"",device:{},isReconnect:!1}),I.control.destroy(),I.rtc.close(),I.wss.close(),I.rtc.clearEffect(),I.wss.clearEffect(),I.control.clearEffect()}return(0,l.useEffect)(()=>{g(_.isShowPresetKeyGUI)},[_.isShowPresetKeyGUI]),(0,l.useEffect)(()=>{u.status===a.fJ.LOADING&&I.wss.effect(t=>{let e=t.data.rotation>0;E(e),I.control.updateStatusInfo(t=>({...t,isHorizontal:e}))},[o._5.JOIN_RES,o._5.NOTIFY])},[u.status]),(0,l.useEffect)(()=>{u.status===a.fJ.PLAYING&&I.wss.send(o.LJ.AUDIO_MUTE,{mute:f})},[u.status,f]),(0,l.useEffect)(()=>{u.status===a.fJ.PLAYING&&I.wss.send(o.LJ.SWITCH_QUALITY,{quality:m})},[u.status,m]),(0,l.useEffect)(()=>()=>{T()},[]),(0,i.jsx)(z.Provider,{value:I,children:e})}},6916:(t,e,s)=>{"use strict";s.d(e,{i:()=>n});var i=s(19779);let n=(0,i.createContext)({progress:{data:0,stop:()=>{},done:()=>{},start:()=>{}},gameInfo:{}});(0,i.createContext)({muted:!1,quality:"480p",isHorizontal:!1})},58179:(t,e,s)=>{"use strict";s.d(e,{MW:()=>o,qP:()=>a});var i=s(19779);let n=(0,i.createContext)({value:{visible:!1,props:{}},setValue:t=>{}}),a=(0,i.createContext)({value:{visible:!1,props:{}},setValue:t=>{}});function o(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layout",e=(0,i.useContext)("game"===t?a:n);return{...e,alert:function(t){e.setValue({visible:!0,props:t})},close:function(){e.setValue({visible:!1,props:{closeByMask:!0}})}}}},13021:(t,e,s)=>{"use strict";s.d(e,{Cp:()=>b,I8:()=>A,Ic:()=>w,OY:()=>N});var i=s(23482),n=s(6916),a=s(79137),o=s(48206),r=s(29615),c=s(96928),l=s(77851),u=s(44103),d=s(97532),h=s(52206),E=s(98907),f=s(16559),p=s(87320),m=s(56952),v=s(71310),g=s(19779),_=s(53984),O=s(58179),I=s(61710),T=s(93855),y=s(25542),S=s(39670);function N(){let{isLogged:t}=(0,T.bG)(),{embeddedChannel:e}=(0,y.K)(),{gameInfo:{details:{gameName:s}}}=(0,g.useContext)(n.i),i=(0,p.useAtomValue)(o.v0),{alert:a,close:r}=(0,O.MW)("game"),l=(0,m.useTranslations)("gameDetail");return{alert:a,closeAlert:r,generateAlertParams:function(n){(0,d.sendGTMEvent)({event:"pop-up",type:n,gameName:s,uid:i.uid,isLogged:Number(t)});let a=l.raw("alert".concat(n,"Content")).replace(/\\n/g,"\n");return{title:l("alert".concat(n,"Title"))||"Notification",desc:e===c.k3.EASYFUN_EXE?a.replaceAll("c-green-5","c-cyan-4"):a,action:l("alert".concat(n,"Btn"))||"Okay",closeByMask:n!==c.fA.QUEUE_INFO,theme:e===c.k3.EASYFUN_EXE?"EMBED_EXE":""}}}}function A(){let{getFingerprint:t}=(0,T.uj)(),e=(0,p.useAtomValue)(r.XM),{isLogged:s}=(0,T.bG)(),[,i]=(0,p.useAtom)(o.v0),n=(0,g.useCallback)(async t=>{let e=await (0,a.Jy)(t);if(e){i({token:null==e?void 0:e.token,uid:null==e?void 0:e.uid,fingerprint:t});try{window.__bl.setConfig({uid:null==e?void 0:e.uid,setUsername:()=>"#_visitor_#"})}catch(t){}return e}},[i]),c=(0,g.useCallback)(async()=>{let{shortToken:s,uid:a}=e,o=await t();s&&a?i({token:s,uid:a,fingerprint:o}):n(o)},[e]);(0,g.useEffect)(()=>{c()},[s,c])}function w(){let t=(0,g.useRef)(!1),{toast:e}=(0,S.dj)(),{getFingerprint:s}=(0,T.uj)(),{alert:i,generateAlertParams:u}=N(),{gameInfo:E,progress:{start:f,stop:_}}=(0,g.useContext)(n.i),O=(0,p.useAtomValue)(r.XM),y=(0,p.useAtomValue)(o.v0),[,A]=(0,p.useAtom)(o.vD),{isLogged:w,logout:b}=(0,T.bG)(),R=(0,v.useSearchParams)(),D=R.get("inv")||"",L=R.get("utm_id")||"",C=R.get("start")||"",M=R.get("n")||"",{serverStatus:x}=(0,I.k)(),[,U]=(0,p.useAtom)(o.tv),P=(0,m.useTranslations)(),k=(0,p.useAtomValue)(o.Zm),{run:G}=(0,h.A)(async()=>{var n,o;if(t.current)return void i({title:"Restricted Regional Access",desc:"Dear EasyFun Users,\n\nDue to cost issues arising from global operations, we will temporarily limit the experience for users in certain regions.\n\nWe deeply appreciate your support and regret any inconvenience caused. We are doing our bestâ€”please believe that we will meet again in the future.\n\nIf you have any questions, please don't hesitate to contact us at Discord.\n\nWith gratitude,\nThe EasyFun Team",action:"Discord",cancel:"Okay",actionCb:()=>window.open("https://discord.gg/SWHpPdHnm2")});if(k)return window.open("https://docs.google.com/document/d/1I0XvarBMceDu_g9p-9whjW67E2cOpoinVq76RYEhkXw/edit");let{gameType:r,gameName:h,gameId:p}=E.details;if((0,d.sendGTMEvent)({event:r===c.YU.CLOUD?"play-cloud-game":"play-web-game",gameName:h,isLogged:Number(w)}),r===c.YU.WEBSITE)return A(t=>({...t,status:c.fJ.PLAYING}));if((0,d.sendGTMEvent)({event:"visitor-play-choose",type:w?c.gg.LOGIN:c.gg.TRIAL}),x.isInDowntime){let t=u(c.fA.SERVER_IN_DOWNTIME);i({...t,desc:null===(n=t.desc)||void 0===n?void 0:n.replace("{min}",String(x.waitDowntimeMin))});return}let m=setTimeout(()=>{f(),clearTimeout(m)},50);A(t=>({...t,status:c.fJ.LOADING}));let v=y;if(v.fingerprint||(v.fingerprint=await s()),!v.token){if(w)v={...v,uid:O.uid,token:O.shortToken};else{let t=await (0,a.Jy)(v.fingerprint);v={...v,...t}}}try{O.email||(O.email=null==O?void 0:null===(o=O.thirdUserInfos[0])||void 0===o?void 0:o.thirdEmail)}catch(t){}let g=await (0,a.ue)({...v,email:O.email,nickName:O.nickname,gameId:String(p),platform:M||D||L});if((null==g?void 0:g.code)===200&&g.data)U(t=>({...t,gameId:String(p),businessWssLink:g.data}));else{if((null==g?void 0:g.code)===401&&b(),_(),A(t=>({...t,status:c.fJ.IDLE})),(null==g?void 0:g.code)===l.E.NO_MORE_USAGE_TIME)return i(u(c.fA.TOTAL_GAME_TIME_EXPIRED));e({icon:c.xT.ERROR,description:P("common.toastOops")||"Oops! Something went wrong."})}},{wait:1500});return(0,g.useEffect)(()=>{"1"===C&&G()},[C]),(0,g.useEffect)(()=>{k&&(0,d.sendGTMEvent)({event:"pop-up",type:99,uid:y.uid})},[k,y]),{start:G}}function b(t,e){let{toast:s}=(0,S.dj)(),{alert:r,generateAlertParams:h}=N(),m=(0,g.useContext)(i.A),{gameInfo:{details:{gameName:v,gameId:O}},progress:{data:I}}=(0,g.useContext)(n.i),[y]=(0,p.useAtom)(o.vD),[A]=(0,p.useAtom)(o.tv),w=(0,g.useMemo)(()=>y.status===c.fJ.LOADING&&I>=99?2e4:void 0,[y.status,I]),b=(0,E.A)(function(){b();let{device:{id:t}}=A;(0,a.WO)(JSON.stringify({browserLang:navigator.language||"unknown",uid:U.uid,nickname:U.nickname||"visitor",deviceId:t,ipInfo:P,localDate:new Date().toLocaleString(),gameName:v,gameId:O})),(0,d.sendGTMEvent)({event:"track-99-error",uid:U.uid,gameName:v,isLogged:Number(k)})},w),R=(0,g.useRef)(0),D=(0,g.useMemo)(()=>y.status===c.fJ.LOADING?1e4:void 0,[y.status]),L=(0,f.A)(function(){R.current+=1,R.current>=12&&(G(),t(),r({...h(c.fA.REMINDER_CHANGE_BROWSER),actionCb:t=>{window.open("https://discord.gg/SWHpPdHnm2"),t()}})),(0,d.sendGTMEvent)({event:"connect-wait-time",seconds:10*R.current,gameName:v,uid:U.uid,isLogged:Number(k)})},D),{start:C,pause:M,isIdle:x}=(0,_.hb)({timeout:3e5,startManually:!0,onIdle:function(){r(h(c.fA.LONG_TIME_NO_ACTIVE));let s=setTimeout(()=>{clearTimeout(s),x()&&(e(JSON.stringify({type:l.O.PAUSE})),t())},3e3)}}),{userInfo:U,userIp:P}=(0,T.Tx)(),{isLogged:k}=(0,T.bG)();function G(){L(),R.current=0}(0,g.useEffect)(()=>(m.wss.effect(async e=>{let{device:{publicIp:i,id:n,accessPort:a}}=A;if(0!==e.data.code){s({icon:c.xT.ERROR,description:"JOIN ERROR!"}),t();try{window.__bl.error(Error("Connect Join Error: id:[".concat(n,"], address:").concat(i,":").concat(a)))}catch(t){}}let o=m.wss.getWSInstance();null==o||o.addEventListener("error",()=>{t();try{window.__bl.error(Error("Device WSS Error: id:[".concat(n,"], address:").concat(o.url)))}catch(t){}}),null==o||o.addEventListener("close",t)},[u._5.JOIN_RES]),m.rtc.effect(()=>{if(y.status===c.fJ.PLAYING){t(),s({icon:c.xT.ERROR,description:"NETWORK ERROR!"});try{let{device:{publicIp:t,id:e,accessPort:s}}=A;window.__bl.error(Error("Connect Device Error: id:[".concat(e,"], address:").concat(t,":").concat(s)))}catch(t){}}},[u.L6.NETWORK_ERROR]),()=>{b(),G()}),[]),(0,g.useEffect)(()=>{y.status!==c.fJ.LOADING&&(b(),G()),y.status===c.fJ.PLAYING?C():M()},[y.status])}},25542:(t,e,s)=>{"use strict";s.d(e,{B:()=>O,K:()=>I});var i=s(23482),n=s(6916),a=s(48206),o=s(29615),r=s(96928),c=s(77851),l=s(97532),u=s(90623),d=s(16559),h=s(6444),E=s(87320),f=s(56952),p=s(19779),m=s(61710),v=s(13021),g=s(93855),_=s(39670);function O(){let{toast:t}=(0,_.dj)(),e=(0,f.useTranslations)(),{isLogged:s,logout:O}=(0,g.bG)(),[I,T]=(0,E.useAtom)(o.Bp),[y,S]=(0,E.useAtom)(a.vD),N=(0,p.useContext)(i.A),A=(0,E.useAtomValue)(a.v0),{gameInfo:w,progress:{stop:b,start:R}}=(0,p.useContext)(n.i),{setShowPersonalState:D}=(0,g.K6)(),{alert:L,closeAlert:C,generateAlertParams:M}=(0,v.OY)(),{serverStatus:x,forceUpdateDowntimeStatus:U}=(0,m.k)(),P=(0,p.useRef)(!1),[k,G]=(0,E.useAtom)(a.tv),{connect:K,disconnect:Y,latestMessage:V,sendMessage:z,readyState:W}=(0,u.A)(k.businessWssLink,{reconnectLimit:0,manual:!0}),j=(0,p.useRef)(W),H=(0,p.useRef)(0),[F,X]=(0,p.useState)(void 0),B=(0,d.A)(()=>{J(JSON.stringify({type:c.O.PING}))},F),q=(0,d.A)(U,P.current?3e3:void 0);function J(t){j.current===h.vj.Open&&z(t)}async function Q(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(j.current===h.vj.Open&&Y(),b(),B(),X(void 0),!t){let{isInDowntime:t}=await U();if(t){P.current=!0;return}}N.resetDevice()}return(0,p.useEffect)(()=>{if(null==V?void 0:V.data)try{!function(i){switch(i.code){case c.E.PONG:break;case c.E.DEVICE_INFO:!function(t){if(2===t.connectStatus&&P.current){P.current=!1;return}C(),S(t=>({...t,status:r.fJ.LOADING}));let{deviceId:e,phoneId:s,accessPort:i,publicIp:n,connectStatus:a,gameId:o}=t;G(t=>({...t,gameId:String(o),device:{id:e,phoneId:s,accessPort:i,publicIp:n},isReconnect:2===a})),T(t.remainingTime)}(i.data);break;case c.E.DUPLICATE_CONNECTION:L(M(r.fA.DUPLICATE_CONNECTION)),Q(!0);break;case c.E.QUEUE_INFO:case c.E.NO_MORE_DEVICE:!function(t){var i;let{queueValue:n}=t.data;t.code===c.E.NO_MORE_DEVICE&&(S(t=>({...t,status:r.fJ.QUEUE})),(0,l.sendGTMEvent)({event:"into-queue",rank:n,uid:A.uid,gameName:w.details.gameName}),H.current=+new Date),n<1?(R(),C(),(0,l.sendGTMEvent)({event:"finish-queue",waitTime:Math.floor((+new Date-H.current)/1e3),uid:A.uid,gameName:w.details.gameName})):(b(),function(){let t=setTimeout(()=>{J(JSON.stringify({type:c.O.QUEUE})),clearTimeout(t)},5e3)}());let a=s?"":"\n".concat(e.raw("gameDetail.alert4SignContent")),o=M(r.fA.QUEUE_INFO);L({...o,desc:null===(i=o.desc)||void 0===i?void 0:i.replace("{signup}",a).replace("{rank}","".concat(n)),action:!s&&e("common.login"),cancel:e("gameDetail.alert".concat(r.fA.QUEUE_INFO,"Btn")),cancelCb:()=>{J(JSON.stringify({type:c.O.CANCEL})),Q(!0),C()},actionCb:()=>{D({show:!0,source:r.Pf.QUEUE_POPUP_BTN})}})}(i);break;case c.E.DEVICE_EXPIRES:L(Object.assign(M(r.fA.FREE_GAME_TIME_EXPIRED),s?{}:{desc:e.raw("gameDetail.alert".concat(r.fA.FREE_GAME_TIME_EXPIRED,"VisitorContent")).replace(/\\n/g,"\n"),action:e("common.login"),actionCb:()=>{D({show:!0,source:r.Pf.TIME_EXPIRED_POPUP})}}));break;case c.E.NO_MORE_USAGE_TIME:L(M(r.fA.TOTAL_GAME_TIME_EXPIRED));break;case c.E.ADD_GAME_TIME:T(i.data);break;default:i.code===c.E.USER_TOKEN_ERROR&&O(),t({icon:r.xT.ERROR,description:e("gameDetail.wsErrorTips".concat(i.code))||e("common.toastOops")||"Oops! Something went wrong."})}[c.E.PONG,c.E.DEVICE_INFO,c.E.QUEUE_INFO,c.E.NO_MORE_DEVICE,c.E.ADD_GAME_TIME].includes(i.code)||(y.status===r.fJ.QUEUE&&C(),Q())}(JSON.parse(V.data))}catch(t){}},[V]),(0,p.useEffect)(()=>{j.current=W,W===h.vj.Open?(J(JSON.stringify({type:c.O.PING})),X(5e3)):W===h.vj.Closed&&y.status!==r.fJ.IDLE&&k.businessWssLink&&Q()},[W]),(0,p.useEffect)(()=>{if(y.status!==r.fJ.LOADING)return;let t=String(w.details.gameId)===k.gameId;(!x.isInDowntime||P.current)&&k.businessWssLink&&t&&(q(),K())},[P,x,k.businessWssLink,k.gameId,y.status]),(0,p.useEffect)(()=>()=>{Q(!0),q()},[]),{connect:K,disconnect:Y,sendMessage:J,restGameStatus:Q,cloudDeviceConnectInfo:k}}function I(){let{isEmbedded:t,channel:e}=(0,E.useAtomValue)(a.Nl);return{isEmbedded:t,embeddedChannel:e}}},39670:(t,e,s)=>{"use strict";s.d(e,{dj:()=>d});var i=s(19779);let n=0,a=new Map;function o(t){if(a.has(t))return;let e=setTimeout(()=>{a.delete(t),l({type:"REMOVE_TOAST",toastId:t})},2e3);a.set(t,e)}let r=[],c={toasts:[]};function l(t){c=function(t,e){switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:s}=e;return s?o(s):t.toasts.forEach(t=>{o(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===s||void 0===s?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}}(c,t),r.forEach(t=>{t(c)})}function u(t){let{...e}=t,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>l({type:"DISMISS_TOAST",toastId:s});return l({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:t=>{t||i()}}}),{id:s,dismiss:i,update:t=>l({type:"UPDATE_TOAST",toast:{...t,id:s}})}}function d(){let[t,e]=i.useState(c);return i.useEffect(()=>(r.push(e),()=>{let t=r.indexOf(e);t>-1&&r.splice(t,1)}),[t]),{...t,toast:u,dismiss:t=>l({type:"DISMISS_TOAST",toastId:t})}}},48206:(t,e,s)=>{"use strict";s.d(e,{Nl:()=>d,RT:()=>r,Zm:()=>u,tv:()=>l,v0:()=>c,vD:()=>o});var i=s(96928),n=s(2154),a=s(40910);let o=(0,n.eU)({status:i.fJ.IDLE,fullscreen:!1}),r=(0,a.tG)("EASYFUN_GAME_HISTORY",[]),c=(0,n.eU)({token:"",uid:"",fingerprint:""}),l=(0,n.eU)({gameId:"",businessWssLink:"",device:{},isReconnect:!1}),u=(0,n.eU)(!1),d=(0,n.eU)({isEmbedded:!1,channel:null})},96928:(t,e,s)=>{"use strict";s.d(e,{Pf:()=>c,Vk:()=>i,YU:()=>n,ap:()=>u,e6:()=>r,fA:()=>l,fJ:()=>d,gg:()=>o,k3:()=>h,xT:()=>a});var i=function(t){return t[t.LOGIN=0]="LOGIN",t[t.SIGNUP=1]="SIGNUP",t[t.RESET=2]="RESET",t}({}),n=function(t){return t[t.CLOUD=1]="CLOUD",t[t.WEBSITE=2]="WEBSITE",t}({}),a=function(t){return t.SUCCESS="success",t.ERROR="error",t.INFO="info",t}({}),o=function(t){return t[t.TRIAL=1]="TRIAL",t[t.LOGIN=2]="LOGIN",t}({}),r=function(t){return t[t.REGISTER=1]="REGISTER",t[t.EMAIL=2]="EMAIL",t[t.GOOGLE=3]="GOOGLE",t[t.GOOGLE_ONE_TAP=4]="GOOGLE_ONE_TAP",t}({}),c=function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.GAME_DETAIL_VISITOR_PLAY_BTN=1]="GAME_DETAIL_VISITOR_PLAY_BTN",t[t.GOOGLE_ONE_TAP=2]="GOOGLE_ONE_TAP",t[t.NAV_ICON=3]="NAV_ICON",t[t.GAME_PANEL_TIPS_BAR_BTN=4]="GAME_PANEL_TIPS_BAR_BTN",t[t.QUEUE_POPUP_BTN=5]="QUEUE_POPUP_BTN",t[t.TIME_EXPIRED_POPUP=6]="TIME_EXPIRED_POPUP",t}({}),l=function(t){return t[t.CLOSE_ALERT=0]="CLOSE_ALERT",t[t.SERVER_LOCATION_TIPS=1]="SERVER_LOCATION_TIPS",t[t.LONG_TIME_NO_ACTIVE=2]="LONG_TIME_NO_ACTIVE",t[t.DUPLICATE_CONNECTION=3]="DUPLICATE_CONNECTION",t[t.QUEUE_INFO=4]="QUEUE_INFO",t[t.FREE_GAME_TIME_EXPIRED=5]="FREE_GAME_TIME_EXPIRED",t[t.TOTAL_GAME_TIME_EXPIRED=6]="TOTAL_GAME_TIME_EXPIRED",t[t.REMINDER_CHANGE_BROWSER=7]="REMINDER_CHANGE_BROWSER",t[t.SERVER_IN_DOWNTIME=8]="SERVER_IN_DOWNTIME",t[t.CHECK_EXIT=9]="CHECK_EXIT",t}({}),u=function(t){return t[t.EDIT=0]="EDIT",t[t.ADD=1]="ADD",t[t.HIDE=2]="HIDE",t[t.SHOW=3]="SHOW",t}({}),d=function(t){return t[t.IDLE=0]="IDLE",t[t.LOADING=1]="LOADING",t[t.QUEUE=2]="QUEUE",t[t.PLAYING=3]="PLAYING",t}({}),h=function(t){return t[t.THIRD_PARTY_WEBSITES=0]="THIRD_PARTY_WEBSITES",t[t.EASYFUN_EXE=1]="EASYFUN_EXE",t}({})},77851:(t,e,s)=>{"use strict";s.d(e,{E:()=>i,O:()=>n});var i=function(t){return t[t.TOO_MANY_REQUEST=8e3]="TOO_MANY_REQUEST",t[t.DUPLICATE_CONNECTION=8001]="DUPLICATE_CONNECTION",t[t.NO_MORE_DEVICE=8002]="NO_MORE_DEVICE",t[t.LONE_TIME_NO_CTRL=8003]="LONE_TIME_NO_CTRL",t[t.CONNECTION_DISCONNECTED=8004]="CONNECTION_DISCONNECTED",t[t.ERROR_CONNECTION=8005]="ERROR_CONNECTION",t[t.DEVICE_EXPIRES=8006]="DEVICE_EXPIRES",t[t.GAME_NOT_EXIST=8007]="GAME_NOT_EXIST",t[t.GAME_ID_ERROR=8008]="GAME_ID_ERROR",t[t.GAME_ID_NULL=8009]="GAME_ID_NULL",t[t.USER_TOKEN_ERROR=8010]="USER_TOKEN_ERROR",t[t.QUEUE_INFO=8011]="QUEUE_INFO",t[t.GAME_PAUSED=8012]="GAME_PAUSED",t[t.ERROR_UID=8013]="ERROR_UID",t[t.USER_TOKEN_EMPTY=8014]="USER_TOKEN_EMPTY",t[t.NO_MORE_USAGE_TIME=8015]="NO_MORE_USAGE_TIME",t[t.ADD_GAME_TIME=8018]="ADD_GAME_TIME",t[t.PONG=200]="PONG",t[t.DEVICE_INFO=8888]="DEVICE_INFO",t}({}),n=function(t){return t.PING="ping",t.RTT="delay",t.QUEUE="queue",t.CANCEL="cancel",t.PAUSE="pause",t}({})},44103:(t,e,s)=>{"use strict";s.d(e,{bB:()=>T,Kq:()=>_,je:()=>I,Si:()=>N,ee:()=>y,L6:()=>E,W8:()=>u,LJ:()=>r,_5:()=>l,Sq:()=>P,UO:()=>v,gm:()=>h,jU:()=>k,G8:()=>A,i4:()=>x});let i=JSON.parse('{"hwsg1.ldcloud.net":"111.119.225.249","port-sg.ldcloud.net":"119.13.169.247"}');class n{effect(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.map(e=>{let i=this.effectList.get(e)||[];this.effectList.set(e,[...i,{callback:t,needEventName:s}])})}hookEvent(t,e){(this.effectList.get(t)||[]).map(s=>{s.needEventName?s.callback(e,t):s.callback(e)})}clearEffectList(){this.effectList.clear()}constructor(){this.effectList=new Map}}var a=function(t){return t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HD=2]="HD",t[t.FULL_HD=3]="FULL_HD",t}({}),o=function(t){return t[t.MOBILE=1]="MOBILE",t[t.PC=0]="PC",t}({}),r=function(t){return t.JOIN="_join",t.OFFER="_offer",t.CANDIDATE="_candidate",t.PING="_ping",t.FORCEI="_forceI",t.AUDIO_MUTE="_audio_mute",t.SWITCH_QUALITY="_switch_quality",t}({}),c=function(t){return t.CLIENT="1",t.SERVER="2",t}({}),l=function(t){return t.JOIN_RES="_join_res",t.ANSWER="_answer",t.NOTIFY="_notify",t.INPUT_STATUS="_transmit",t}({}),u=function(t){return t[t["360P"]=0]="360P",t[t["480P"]=1]="480P",t[t["720P"]=2]="720P",t[t["1080P"]=3]="1080P",t}({});class d extends n{setParams(t){return this.url=t.url,this}connect(){return new Promise((t,e)=>{this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{t(this.ws),this.ws&&(this.ws.onmessage=t=>{let e=JSON.parse(t.data);this.hookEvent(e.eventName,e)},this.ws.onerror=e)}})}send(t,e){var s;null===(s=this.ws)||void 0===s||s.send(JSON.stringify({eventType:c.CLIENT,eventName:t,data:e}))}close(){var t;null===(t=this.ws)||void 0===t||t.close()}constructor(...t){super(...t),this.ws=null,this.url=""}}function h(){let t=new d;return{getWSInstance:()=>t.ws,close:t.close.bind(t),send:t.send.bind(t),setParams:t.setParams.bind(t),connect:t.connect.bind(t),effect:t.effect.bind(t),clearEffectList:t.clearEffectList.bind(t)}}var E=function(t){return t.STREAM="stream",t.DATA_CHANNEL_OPEN="data_channel_open",t.DATA_CHANNEL_MESSAGE="data_channel_message",t.RTT="rtt",t.CANDIDATE="candidate",t.STATUS_DATA="status_data",t.NETWORK_ERROR="network_error",t}({}),f=function(t){return t.CLIENT="1",t}({}),p=function(t){return t.TOUCH="_touch2",t.MOVE="_move",t.INPUT="_text",t.SYSTEM_KEY="_key",t}({});class m extends n{init(){this.rtc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}),this.rtc.addTransceiver("video",{direction:"recvonly"}),this.rtc.addTransceiver("audio",{direction:"recvonly"}),this.listenStream(),this.initDataChannel(),this.interval&&clearInterval(this.interval),this.interval=setInterval(this.getRtcStatus.bind(this),2e3),this.listenIceCandidate()}listenStream(){this.rtc&&(this.rtc.addEventListener("track",t=>{this.hookEvent(E.STREAM,t.streams[0])}),this.rtc.addEventListener("addstream",t=>{this.hookEvent(E.STREAM,t.stream)}),this.rtc.addEventListener("addtrack",t=>{this.hookEvent(E.STREAM,t)}))}listenIceCandidate(){this.rtc&&this.rtc.addEventListener("icecandidate",t=>{t.candidate&&!this.isEffectedIceCandidate&&(this.isEffectedIceCandidate=!0,this.hookEvent(E.CANDIDATE,t.candidate),this.wsSend(r.CANDIDATE,t.candidate))})}initDataChannel(){this.rtc&&(this.dataChannel=this.rtc.createDataChannel("MessageChannel",{ordered:!0}),this.dataChannel.onopen=t=>{this.hookEvent(E.DATA_CHANNEL_OPEN,t),this.getRtcStatus()})}async createOffer(){if(!this.rtc)return;let t=await this.rtc.createOffer();return await this.rtc.setLocalDescription(t),t}async setRemoteDescription(t,e){this.rtc&&t.sdp&&(t.sdp=function(t,e,s){let n=t.split("\r\n").filter(t=>!t.includes("msid:zlmediakit-mslabel zlmediakit-label")).join("\r\n"),a=i[e]||e;return n.replace(/(candidate:[^\s]+ \d+ (udp|tcp) \d+ )([0-9.]+) (\d+)(.*)/g,"$1".concat(a," ").concat(s,"$5"))}(t.sdp,e.ip,e.port),await this.rtc.setRemoteDescription(t))}async getRtcStatus(){if(this.rtc){if((await this.rtc.getStats()).forEach(t=>{Object.keys(t).forEach(e=>{if("currentRoundTripTime"===e){let e=1e3*t.currentRoundTripTime;this.hookEvent(E.RTT,e),this.prevRtt=e;return}}),t.jitter&&"video"===t.kind&&(this.hookEvent(E.STATUS_DATA,t),this.wsSend(r.PING,t))}),0!==this.prevUpdateStream&&+new Date-this.prevUpdateStream>8e3){if(console.info("video stopppppppppppppppppppppppppppppppppppped"),this.wsSend(r.FORCEI,{}),this.videoForcei+=1,this.videoForcei>=10){this.hookEvent(E.NETWORK_ERROR,{});try{window.__bl.sum("connect-rtc-error",1)}catch(t){}}}else this.videoForcei=0}}videoUpdateTimeout(){this.prevUpdateStream=+new Date}dataChannelSend(t,e){this.dataChannel&&"open"===this.dataChannel.readyState&&this.dataChannel.send(JSON.stringify({eventType:f.CLIENT,eventName:t,data:e}))}addCandidate(t){if(!this.rtc)return;let e=new RTCIceCandidate({sdpMid:"0",sdpMLineIndex:0,candidate:t});this.rtc.addIceCandidate(e).catch(t=>{try{window.__bl.sum("add-ice-candidate-error",1),window.__bl.error(Error("RTC addIceCandidate Error"))}catch(t){}})}getLastRtt(){return this.prevRtt}close(){var t;null===(t=this.rtc)||void 0===t||t.close(),this.prevUpdateStream=0,this.interval&&clearInterval(this.interval)}constructor(t,e){super(),this.isEffectedIceCandidate=!1,this.interval=null,this.rtc=null,this.dataChannel=null,this.prevUpdateStream=0,this.videoForcei=0,this.prevRtt=0,this.wsSend=t,this.wsEffect=e}}function v(t,e){let s=new m(t,e);return{getRTCInstance:()=>s.rtc,close:s.close.bind(s),init:s.init.bind(s),rtcEffect:s.effect.bind(s),createOffer:s.createOffer.bind(s),dataChannelSend:s.dataChannelSend.bind(s),videoUpdateTimeout:s.videoUpdateTimeout.bind(s),setRemoteDescription:s.setRemoteDescription.bind(s),addCandidate:s.addCandidate.bind(s),getLastRtt:s.getLastRtt.bind(s),clearEffectList:s.clearEffectList.bind(s)}}var g=s(38916),_=function(t){return t.MULTI_TOUCH="multi_touch",t.MOVE="move",t.CONTROL_RECT_RESIZE="control_rect_resize",t.PRESET_KEYBOARD_DOWN="preset_keyboard_down",t.PRESET_KEYBOARD_UP="preset_keyboard_up",t.KEYBOARD_DOWN="keyboard_down",t.KEYBOARD_UP="keyboard_up",t.KEYBOARD_DATA_UPDATE="keyboard_data_update",t.TOGGLE_SCREEN_FOLLOW_SCREEN_STATUS="toggle_screen_follow_screen_status",t}({}),O=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=2]="UP",t}({}),I=function(t){return t.HOME="0",t.MENU="1",t.BACK="2",t.VOLUME_ADD="3",t.VOLUME_SUB="4",t.DELETE="5",t.ENTER="6",t}({}),T=function(t){return t[t.UP=0]="UP",t[t.LEFT=1]="LEFT",t[t.DOWN=2]="DOWN",t[t.RIGHT=3]="RIGHT",t}({}),y=function(t){return t[t.TOUCH=0]="TOUCH",t[t.COMPASS=1]="COMPASS",t[t.ZOOM=2]="ZOOM",t[t.ROTATION=3]="ROTATION",t}({}),S=function(t){return t[t.DOWN=0]="DOWN",t[t.MOVE=1]="MOVE",t[t.UP=2]="UP",t[t.MOVE_END_UP=3]="MOVE_END_UP",t[t.DOWN_IN_MOVE=4]="DOWN_IN_MOVE",t[t.UP_IN_MOVE=5]="UP_IN_MOVE",t}({}),N=function(t){return t[t.PORTRAIT=0]="PORTRAIT",t[t.LANDSCAPE=1]="LANDSCAPE",t}({});function A(){var t,e;let s=!1;return e=navigator.userAgent||navigator.vendor||(null===(t=window)||void 0===t?void 0:t.opera),(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(s=!0),s}function w(t){let e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},s=e()+e();if(t)for(;void 0!==t[s];)s=e()+e();return s}function b(t,e,s,i){return{x:Math.round(t/s*1e3),y:Math.round(e/i*1e3)}}function R(t,e,s,i){let{left:n,top:a,width:o,height:r}=s;return function(t,e,s,i,n){let{x:a,y:o}=b(t,e,s,i);return n?{x:Math.abs(o-1e3),y:a}:{x:a,y:o}}(Math.round(t-n),Math.round(e-a),o,r,i)}function D(t,e,s){let i=0,n=0,a=[];if(t.type.includes("touch")){"touchstart"===t.type&&t.preventDefault();let i="touchend"===t.type?t.changedTouches:t.touches;if(i.length)for(let t=0;t<i.length;t++)a.push({id:i[t].identifier,...R(i[t].pageX,i[t].pageY,e,s)})}else i=t.pageX,n=t.pageY,a.push({id:0,...R(i,n,e,s)});return a}function L(t,e,s,i,n,a){let o=a?Math.abs(s-1e3):e,r=Math.round(t/2),c=Math.round(t/(a?n/i:i/n)/2);return{deviceYRadius:r,deviceXRadius:c,centerX:o+(a?-c:r),centerY:(a?e:s)+(a?t:r)/2}}let C=["escape","space","enter","shift","alt","tab","control","`"],M={escape:["Escape"],space:["Space"],enter:["Enter","NumpadEnter"],shift:["ShiftLeft","ShiftRight"],alt:["AltLeft","AltRight"],tab:["Tab"],control:["ControlLeft","ControlRight"],"`":["Backquote"]};function x(t,e){let s={interactive:{},logic:{}},i=JSON.parse(t);if(null==i?void 0:i.logic)return i;let n=(e===N.PORTRAIT?272:856)/1e3;return Object.keys(i).map(t=>{let e=i[t],a=t.split("___")[1],o="Key".concat(a.toUpperCase());if("wasd"===a){let t=s.logic.KeyW||[],i=s.logic.KeyA||[],a=s.logic.KeyS||[],o=s.logic.KeyD||[],r=w(s.interactive);s.interactive[r]={code:["KeyW","KeyA","KeyS","KeyD"],width:e.size/n,height:e.size/n,x:e.left,y:e.top,name:{[T.UP]:"W",[T.LEFT]:"A",[T.DOWN]:"S",[T.RIGHT]:"D"},zIndex:1,type:y.COMPASS},s.logic.KeyW=[...t,{patch:y.COMPASS,direction:T.UP,interactive:r}],s.logic.KeyA=[...i,{patch:y.COMPASS,direction:T.LEFT,interactive:r}],s.logic.KeyS=[...a,{patch:y.COMPASS,direction:T.DOWN,interactive:r}],s.logic.KeyD=[...o,{patch:y.COMPASS,direction:T.RIGHT,interactive:r}]}else if(isNaN(Number(a))){if(C.includes(a.toLocaleLowerCase()))M[a.toLocaleLowerCase()].map(t=>{let i=s.logic[t]||[],a=w(s.interactive);s.interactive[a]={code:[t],width:40/n,height:40/n,x:e.left,y:e.top,name:t,zIndex:1,type:y.TOUCH},s.logic[t]=[...i,{patch:y.TOUCH,interactive:a}]});else{let t=s.logic[o]||[],i=w(s.interactive);s.interactive[i]={code:[o],width:40/n,height:40/n,x:e.left,y:e.top,name:a,zIndex:1,type:y.TOUCH},s.logic[o]=[...t,{patch:y.TOUCH,interactive:i}]}}else{let t="Digit".concat(a),i="Numpad".concat(a),o=s.logic[t]||[],r=s.logic[i]||[],c=w(s.interactive);s.interactive[c]={code:[t],width:40/n,height:40/n,x:e.left,y:e.top,name:t,zIndex:1,type:y.TOUCH};let l=w(s.interactive);s.interactive[l]={code:[i],width:40/n,height:40/n,x:e.left,y:e.top,name:i,zIndex:1,type:y.TOUCH},s.logic[t]=[...o,{patch:y.TOUCH,interactive:c}],s.logic[i]=[...r,{patch:y.TOUCH,interactive:l}]}}),s}class U extends n{getStatusInfo(){return(0,g.m)(this.status)}getVideoRect(){return this.rect}listenerToggleInputStatus(){this.wsEffect(t=>{try{var e,s;let i=JSON.parse(t.data);this.status.isInputStatus=i.IMEIsActive,this.status.isInputStatus?(this.inputStatusKeyboardElement||this.initInputElement(),null===(e=this.inputStatusKeyboardElement)||void 0===e||e.focus()):(null===(s=this.inputStatusKeyboardElement)||void 0===s||s.remove(),this.inputStatusKeyboardElement=null)}catch(t){}},[l.INPUT_STATUS])}consumeLocusData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;if(this.status.isFreezeControl)return;let{status:s,x:i,y:n}=e;switch(s){case S.DOWN:if(!this.locusList.size){let e=t.startsWith("touch-")&&!this.activeKeyMap.size,s=1===this.activeKeyMap.size;if(e||s){this.dataChannelSend(p.TOUCH,{type:O.DOWN,x:i,y:n});break}}this.consumeLocusData(t,{x:i,y:n,status:S.MOVE});break;case S.MOVE:let a=[];t&&this.locusList.set(t,{x:i,y:n,status:S.MOVE}),this.locusList.forEach(t=>{t.status===S.MOVE&&a.push({x:t.x,y:t.y,id:a.length})}),this.dataChannelSend(p.MOVE,a);break;case S.UP:this.locusList.delete(t),this.activeKeyMap.delete(t),this.activeKeyMap.size||this.locusList.size?this.consumeLocusData("",{status:S.MOVE,x:0,y:0}):this.dataChannelSend(p.TOUCH,{type:O.UP,x:i,y:n})}}initInputElement(){var t;this.inputStatusKeyboardElement=document.createElement("input"),this.inputStatusKeyboardElement.setAttribute("type","text"),this.inputStatusKeyboardElement.setAttribute("id","abcdefg"),this.inputStatusKeyboardElement.setAttribute("style","position: fixed; top: -1000px; left: 0; opacity: 0; z-index: -10; pointer-event: none;"),this.inputStatusKeyboardElement.addEventListener("input",t=>{(null==t?void 0:t.inputType)!=="insertFromPaste"&&this.handleTextInput(t)}),this.inputStatusKeyboardElement.addEventListener("compositionend",t=>this.handleTextInput(t,!0)),this.inputStatusKeyboardElement.addEventListener("paste",t=>{var e;let s=(t.clipboardData||(null===(e=window)||void 0===e?void 0:e.clipboardData)).getData("text");this.handleTextInput({data:s},!0)}),null===(t=document.querySelector(this.fullscreenElementId))||void 0===t||t.appendChild(this.inputStatusKeyboardElement)}handleTextInput(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!t.isComposing||e)&&this.dataChannelSend(p.INPUT,{msg:t.data})}updateStatusInfo(t){let e="function"==typeof t?t(this.status):{...this.status,...t};this.status=(0,g.m)(e),e.configKeyboard&&e.configKeyboard!==this.status.configKeyboard&&this.hookEvent(_.KEYBOARD_DATA_UPDATE,{data:e.configKeyboard})}handleCompassTask(){this.compassInterval||(this.compassInterval=setInterval(()=>{this.activeCompassMap.forEach((t,e)=>{let s=function(t,e){let{hotPress:s,deviceCoord:i,fivePoints:n,prevHotPressSize:a}=t,o=i||{x:n.centerX,y:n.centerY};if(a!==s.size){let{centerX:t,centerY:e}=n;o={x:t,y:e}}let r=e?T.UP:T.RIGHT,c=e?T.DOWN:T.LEFT,l=e?T.LEFT:T.UP,u=e?T.RIGHT:T.DOWN;return s.has(r)&&(o=o.x<n.topX?{x:o.x+=10,y:o.y}:o),s.has(c)&&(o=o.x>n.bottomX?{x:o.x-=10,y:o.y}:o),s.has(l)&&(o=o.y>n.leftY?{x:o.x,y:o.y-=10}:o),s.has(u)&&(o=o.y<n.rightY?{x:o.x,y:o.y+=10}:o),o}(t,this.status.isHorizontal);this.activeCompassMap.set(e,{...t,prevHotPressSize:t.hotPress.size,deviceCoord:s}),this.consumeLocusData(e,{x:s.x,y:s.y,status:S.MOVE})}),!this.activeCompassMap.size&&this.compassInterval&&(clearInterval(this.compassInterval),this.compassInterval=null)},this.compassMoveInterval))}setControlLayerElement(t){if(t){let e=this.setRect();null==e||e.observe(t),this.isRegisteredKeyboardListener||(this.listenerToggleInputStatus(),this.keydownListener=this.keydown.bind(this),this.keyupListener=this.keyup.bind(this),this.wheelListener=this.wheel.bind(this),window.addEventListener("keydown",this.keydownListener,!0),window.addEventListener("keyup",this.keyupListener,!0),t.addEventListener("wheel",this.wheelListener,{passive:!1}),this.isRegisteredKeyboardListener=!0)}}checkComposeIsActive(t){if(!t)return!1;let e=0;return t.forEach(t=>{this.activeKeyMap.has(t)&&(e+=1)}),e===t.length}triggerSystemKey(t){this.dataChannelSend(p.SYSTEM_KEY,{type:"0",x:t})}wheel(t){if(!this.activeKeyMap.size||this.isInZoomStatus){if(t.preventDefault(),this.wheelStatus.timer&&clearTimeout(this.wheelStatus.timer),this.wheelStatus.timer=setTimeout(()=>{this.wheelStatus.isWheeling=!1,this.consumeLocusData("system-wheel-scroll",{status:S.UP,...this.wheelStatus.prevXY})},100),!this.wheelStatus.isWheeling){this.wheelStatus.isWheeling=!0;let[{x:e,y:s}]=D(t,this.rect,this.status.isHorizontal);this.status.isHorizontal&&(s+=t.deltaY),this.isInZoomStatus||this.consumeLocusData("system-wheel-scroll",{status:S.DOWN,x:e,y:s}),this.wheelStatus.startXY={x:e,y:s},this.wheelStatus.prevXY={x:e,y:s},this.wheelStatus.zoom1XY={x:e,y:t.deltaY>0?s+400:s},this.wheelStatus.zoom2XY={x:e,y:t.deltaY>0?s-400:s};return}if(this.isInZoomStatus){let e=0;for(;e<10;)t.deltaY<0?(this.wheelStatus.zoom1XY.y+=2,this.wheelStatus.zoom2XY.y-=2):(this.wheelStatus.zoom1XY.y-=2,this.wheelStatus.zoom2XY.y+=2),this.consumeLocusData("zoom-by-wheel-1",{status:S.MOVE,...this.wheelStatus.zoom1XY}),this.consumeLocusData("zoom-by-wheel-2",{status:S.MOVE,...this.wheelStatus.zoom2XY}),e+=1}else{let e=0;for(;e<10;){let s=t.deltaY>0?2*e:-2*e;this.status.isHorizontal?this.wheelStatus.prevXY.x+=s:this.wheelStatus.prevXY.y+=s,this.consumeLocusData("system-wheel-scroll",{status:S.MOVE,...this.wheelStatus.prevXY}),e+=1}}}}keydown(t){if(!t.isComposing&&229!==t.keyCode){if(this.hookEvent(_.KEYBOARD_DOWN,{event:t}),this.status.isInputStatus){let e=["Delete","Backspace","Enter"].findIndex(e=>e===t.key);!(e<0)&&this.triggerSystemKey(e>1?I.ENTER:I.DELETE)}else{var e;let s=null===(e=this.status.configKeyboard)||void 0===e?void 0:e.logic[t.code];if(s&&s.length){if(t.preventDefault(),this.activeKeyMap.has(t.code))return;this.activeKeyMap.add(t.code),s.map(e=>{var i;let n=null===(i=this.status.configKeyboard)||void 0===i?void 0:i.interactive[e.interactive];if(!e.isCompose||this.checkComposeIsActive(e.composition)){if(n){let{width:t,x:s,y:i}=n;switch(e.patch){case y.TOUCH:let{centerX:a,centerY:o}=L(t,s,i,this.rect.width,this.rect.height,this.status.isHorizontal);this.consumeLocusData(e.interactive,{status:S.DOWN,x:a,y:o});break;case y.COMPASS:let r=this.activeCompassMap.get(e.interactive);if(!r){let n=function(t,e,s,i,n,a){let{deviceYRadius:o,deviceXRadius:r,centerX:c,centerY:l}=L(t,e,s,i,n,a);return{centerX:c,centerY:l,leftX:c,leftY:l-o,rightX:c,rightY:l+o,topX:c+r,topY:l,bottomX:c-r,bottomY:l}}(t,s,i,this.rect.width,this.rect.height,this.status.isHorizontal);r={fivePoints:n,hotPress:new Set,prevHotPressSize:0},this.consumeLocusData(e.interactive,{status:S.DOWN,x:n.centerX,y:n.centerY})}r.hotPress.add(e.direction),this.activeCompassMap.set(e.interactive,r),this.handleCompassTask();break;case y.ZOOM:this.isInZoomStatus=!0,this.consumeLocusData("zoom-by-wheel-1",{status:S.DOWN,x:s,y:i})}}this.hookEvent(_.PRESET_KEYBOARD_DOWN,{code:t.code,uiId:s.map(t=>t.interactive),activeKeyMap:this.activeKeyMap})}})}}}}keyup(t){var e;if(this.hookEvent(_.KEYBOARD_UP,{event:t}),this.status.isInputStatus)return;let s=null===(e=this.status.configKeyboard)||void 0===e?void 0:e.logic[t.code];s&&s.length&&(t.preventDefault(),this.activeKeyMap.delete(t.code),s.map(t=>{var e;let s=null===(e=this.status.configKeyboard)||void 0===e?void 0:e.interactive[t.interactive];if(s){let{x:e,y:i,width:n}=s;if(t.patch===y.TOUCH){let{centerX:s,centerY:a}=L(n,e,i,this.rect.width,this.rect.height,this.status.isHorizontal);this.consumeLocusData(t.interactive,{status:S.UP,x:s,y:a})}else if(t.patch===y.COMPASS){let e=this.activeCompassMap.get(t.interactive);e&&(e.hotPress.delete(t.direction),e.hotPress.size?this.activeCompassMap.set(t.interactive,{...e}):(this.activeCompassMap.delete(t.interactive),this.consumeLocusData(t.interactive,{status:S.UP,x:e.fivePoints.centerX,y:e.fivePoints.centerY})))}else t.patch===y.ROTATION?(this.isScreenFollowMouseStatus.working=!this.isScreenFollowMouseStatus.working,this.isScreenFollowMouseStatus.key=t.interactive,this.consumeLocusData(t.interactive,{status:this.isScreenFollowMouseStatus.working?S.DOWN:S.UP,x:e,y:i}),this.hookEvent(_.TOGGLE_SCREEN_FOLLOW_SCREEN_STATUS,{status:this.isScreenFollowMouseStatus.working})):t.patch===y.ZOOM&&(this.isInZoomStatus=!1,this.consumeLocusData("zoom-by-wheel-1",{status:S.UP,...this.wheelStatus.zoom1XY}),this.consumeLocusData("zoom-by-wheel-2",{status:S.UP,...this.wheelStatus.zoom2XY}))}}),this.hookEvent(_.PRESET_KEYBOARD_UP,{code:t.code,uiId:s.map(t=>t.interactive),activeKeyMap:this.activeKeyMap}))}setRect(){try{return new ResizeObserver(t=>{window.requestAnimationFrame(()=>{if(Array.isArray(t)&&t.length){for(let e of t)if(e.target){let{left:t,top:s,width:i,height:n}=e.target.getBoundingClientRect();this.rect={left:t,top:s,width:i,height:n},this.hookEvent(_.CONTROL_RECT_RESIZE,this.rect)}}})})}catch(t){}}down(t){this.isPress=!0;let[{x:e,y:s,id:i}]=D(t,this.rect,this.status.isHorizontal),n={type:O.DOWN,x:e,y:s};this.consumeLocusData("touch-".concat(i||0),{status:S.DOWN,x:e,y:s}),this.hookEvent(_.MULTI_TOUCH,n)}move(t){let{working:e,key:s}=this.isScreenFollowMouseStatus;if(this.isPress||e){let i=D(t,this.rect,this.status.isHorizontal);e&&!this.activeKeyMap.size&&this.consumeLocusData(s,{status:S.DOWN,x:i[0].x,y:i[0].y}),i.map(t=>{let i=e?s:"touch-".concat(t.id||0);this.consumeLocusData(i,{status:S.MOVE,x:t.x,y:t.y})}),this.hookEvent(_.MOVE,i)}}up(t){this.isPress=!1;let[{x:e,y:s,id:i}]=D(t,this.rect,this.status.isHorizontal),n={type:O.UP,x:e,y:s};this.consumeLocusData("touch-".concat(i||0),{status:S.UP,x:e,y:s}),this.hookEvent(_.MULTI_TOUCH,n)}interactiveUnbindLogic(t,e,s){t.forEach(t=>{if(this.status.configKeyboard&&this.status.configKeyboard.logic[t]){var i;this.status.configKeyboard.logic[t]=null===(i=this.status.configKeyboard.logic[t])||void 0===i?void 0:i.filter(t=>void 0===s?t.interactive!==e:t.interactive===e?Number(s)!==Number(t.direction):void 0),this.status.configKeyboard.logic[t].length||delete this.status.configKeyboard.logic[t]}})}interactiveBindLogic(t,e,s,i){t.forEach((n,a)=>{if(this.status.configKeyboard){let o;let r=this.status.configKeyboard.logic[n]||[],c=t.length>0&&e!==y.COMPASS;c&&(o=t.filter(t=>t!==n));let l={patch:e,interactive:s,isCompose:c,direction:i?Number(i):void 0,composition:o};e===y.COMPASS&&(l.direction=a),this.status.configKeyboard.logic[n]=[...r,l]}})}translateControlAreaRectData(t){if((null==t?void 0:t.x)&&(null==t?void 0:t.y)){let{x:e,y:s}=b(t.x,t.y,this.rect.width,this.rect.height);t={...t,x:e,y:s}}return(null==t?void 0:t.width)&&(null==t?void 0:t.height)&&(t={...t,width:Math.round(t.width/this.rect.width*1e3),height:Math.round(t.height/this.rect.width*1e3)}),t}addControlArea(t){if(!this.status.configKeyboard)return;let e=w(this.status.configKeyboard.interactive);t={...t,...this.translateControlAreaRectData(t)},this.status.configKeyboard.interactive[e]=t,this.interactiveBindLogic(t.code,t.type,e),this.hookEvent(_.KEYBOARD_DATA_UPDATE,{data:this.status.configKeyboard})}setControlArea(t,e){if(!this.status.configKeyboard)return;let s={...this.status.configKeyboard.interactive[e]};s&&((t={...t,...this.translateControlAreaRectData(t)}).direction&&t.name&&s.type===y.COMPASS&&"object"==typeof s.name&&(t.name={...s.name,[t.direction]:t.name}),(null==t?void 0:t.code)&&(this.interactiveUnbindLogic(s.code,e,t.direction),this.interactiveBindLogic(t.code,s.type,e,t.direction)),this.status.configKeyboard.interactive[e]={...s,...t},this.hookEvent(_.KEYBOARD_DATA_UPDATE,{data:this.status.configKeyboard}))}deleteControlArea(t){if(!this.status.configKeyboard)return;let e=this.status.configKeyboard.interactive[t];this.interactiveUnbindLogic(e.code,t),delete this.status.configKeyboard.interactive[t],this.hookEvent(_.KEYBOARD_DATA_UPDATE,{data:this.status.configKeyboard})}destroy(){this.compassInterval&&clearInterval(this.compassInterval),this.keydownListener&&window.removeEventListener("keydown",this.keydownListener,!0),this.keyupListener&&window.removeEventListener("keyup",this.keyupListener,!0),this.keydownListener=null,this.keyupListener=null,this.isRegisteredKeyboardListener=!1}constructor(t,e,s){super(),this.isPress=!1,this.isRegisteredKeyboardListener=!1,this.status={isHorizontal:!1,isInputStatus:!1,isFreezeControl:!1,configKeyboard:{logic:{},interactive:{}}},this.rect={left:0,top:0,width:0,height:0},this.prevInputText="",this.inputStatusKeyboardElement=null,this.fullscreenElementId="#fullscreen-element",this.activeKeyMap=new Set,this.activeCompassMap=new Map,this.keydownListener=null,this.keyupListener=null,this.wheelListener=null,this.compassMoveInterval=3,this.compassInterval=null,this.locusList=new Map,this.wheelStatus={isWheeling:!1,startXY:{x:0,y:0},prevXY:{x:0,y:0},zoom1XY:{x:0,y:0},zoom2XY:{x:0,y:0},timer:null},this.isScreenFollowMouseStatus={working:!1,key:""},this.isInZoomStatus=!1,this.wsSend=t,this.wsEffect=e,this.dataChannelSend=s}}function P(t,e,s){let i=new U(t,e,s);return{control:i,down:i.down.bind(i),move:i.move.bind(i),up:i.up.bind(i),setControlLayerElement:i.setControlLayerElement.bind(i),triggerSystemKey:i.triggerSystemKey.bind(i),destroy:i.destroy.bind(i),effect:i.effect.bind(i),getStatusInfo:i.getStatusInfo.bind(i),getVideoRect:i.getVideoRect.bind(i),updateStatusInfo:i.updateStatusInfo.bind(i),clearEffectList:i.clearEffectList.bind(i),addControlArea:i.addControlArea.bind(i),setControlArea:i.setControlArea.bind(i),deleteControlArea:i.deleteControlArea.bind(i)}}function k(t){let{deviceId:e,ip:s,gameInfo:i,...n}=t,{token:r,uid:c}=n,l=JSON.stringify({deviceId:e,token:r,uid:c}),u=A()?o.MOBILE:o.PC;return{authparams:l,quality:a.HD,sys_locale:"en-US",type:u,user_agent:window.navigator.userAgent,cloudgame_cfg:i,...n}}},64605:()=>{}}]);